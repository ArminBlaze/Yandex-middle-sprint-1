<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
		}

		.login {
			display: flex;
			flex-direction: column;
			padding-top: 20px;
		}

		.login__header {
			text-align: center;
		}

		.loginForm {
			margin: 0 auto;

		}

		.loginForm label {
			display: block;
			margin-bottom: 10px;
		}
	</style>
</head>
<body>
	<div class="login">
		<h2 class="login__header">Вход</h2>
		<form class="loginForm" action="">
			<label>
				Логин
				<input type="text" name="login">
			</label>
			<label>
				Пароль
				<input type="password" name="password">
			</label>
			<button type="submit">Зайти</button>
		</form>
	</div>
</body>

<script>
	const host = 'https://ya-praktikum.tech';

	const form = document.querySelector('.loginForm')


	form.addEventListener('submit', (event) => {
		event.preventDefault();
		
		console.log(form.login.value);
		console.log(form.password.value);

		const data = {
			login: form.login.value,
			password: form.password.value
		}

		makeLogin(data);
	})

	function makeLogin(data) {

		const json = JSON.stringify(data) 

		fetch(`${host}/api/v2/auth/signin`, {
			method: 'POST',
			credentials: 'include', // Нужно подставлять куки
			mode: 'cors', // Работаем с CORS
			headers: { //данные у нас в FormData, поэтому это не нужно
				'content-type': 'application/json', // Данные отправляем в формате JSON
			},
			body: json
		})
			.then(response => response.text()) // Можно вытащить через .json()
			.then(data => {
				console.log(data);
				return data;
			})
			.then(data => {
				fetch(`${host}/api/v2/auth/user`, { // Получаем подробную информацию о пользователе и проверяем, что куки проставились
					method: 'GET',
					mode: 'cors',
					credentials: 'include',
				})
				.then(r => r.json())
				.then(data => {
					console.log('user', data);
				});
			});
	}
</script>
</html>